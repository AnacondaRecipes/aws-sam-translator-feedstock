{% set name = "aws-sam-translator" %}
{% set version = "1.101.0" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  - url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/{{ name | replace('-', '_') }}-{{ version }}.tar.gz
    sha256: 234c1ca29d47f2cd276858371d4a646bc5cdb0de1e07724721d9358d6de005aa
  - url: https://github.com/awslabs/serverless-application-model/archive/refs/tags/v{{ version }}.tar.gz
    sha256: 07588b005b2a9f4e79d6f86d9a5f4464f6663e0c64701729897f90c397542a16
    folder: tests_src

build:
  number: 0
  script: {{ PYTHON }} -m pip install . --no-deps --no-build-isolation -vv
  skip: true  # [py<38]

requirements:
  host:
    - python
    - pip
    - setuptools
    - wheel
  run:
    - python
    - boto3 >=1.34.0,<2.0.0
    - jsonschema >=3.2,<5
    - typing_extensions >=4.4
    - pydantic >=1.8,<3,!=1.10.15,!=1.10.17

# E samtranslator.translator.arn_generator.NoRegionFound: AWS Region cannot be found
{% set skip_test = "--ignore=tests_src/tests/plugins/application/test_serverless_app_plugin.py" %}
{% set skip_test = skip_test + " --ignore=tests_src/tests/unit/test_region_configuration.py" %}
# E       AssertionError: 18446744073675828635 != 484452592760221083
{% set deselect_tests = "" %}
{% set deselect_tests = deselect_tests + " --deselect=tests_src/tests/utils/test_py27hash_fix.py::TestPy27UniStr::test_py27_hash" %}  # [win]

test:
  source_files:
    - tests_src/tests
    - tests_src/bin
    - tests_src/schema_source
    - tests_src/samtranslator
  imports:
    - samtranslator
    - samtranslator.intrinsics
    - samtranslator.model
    - samtranslator.parser
    - samtranslator.plugins
    - samtranslator.policy_template_processor
    - samtranslator.public
    - samtranslator.sdk
    - samtranslator.swagger
    - samtranslator.translator
    - samtranslator.validator
  requires:
    - pip
    - pytest >=6.2,<8
    - parameterized >=0.7.0,<0.8.0
    - pyyaml >=6.0,<7.0
  commands:
    - pip check
    - python -c "from importlib.metadata import version; assert(version('{{ name }}')=='{{ version }}')"
    - pytest -v tests_src/tests {{ skip_test }} {{ deselect_tests }}

about:
  home: https://github.com/awslabs/serverless-application-model
  license: Apache-2.0
  license_family: Apache
  license_file: LICENSE
  summary: AWS Serverless Application Model (AWS SAM) prescribes rules for expressing Serverless applications on AWS.
  description: |
    You can use SAM to define serverless applications in simple and clean syntax.
    This GitHub project is the starting point for AWS SAM.
    It contains the SAM specification, the code that translates SAM templates into
    AWS CloudFormation stacks, general information about the model, and examples of common applications.
  doc_url: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html
  dev_url: https://github.com/awslabs/serverless-application-model

extra:
  recipe-maintainers:
    - jan-janssen
    - mxr-conda
    - hajapy
    - rluria14
    - oblute
    - ndmaxar
